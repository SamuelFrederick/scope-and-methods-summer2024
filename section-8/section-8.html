<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sam Frederick">
<meta name="dcterms.date" content="2023-06-14">

<title>Section 8. Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="section-8_files/libs/clipboard/clipboard.min.js"></script>
<script src="section-8_files/libs/quarto-html/quarto.js"></script>
<script src="section-8_files/libs/quarto-html/popper.min.js"></script>
<script src="section-8_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="section-8_files/libs/quarto-html/anchor.min.js"></script>
<link href="section-8_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="section-8_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="section-8_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="section-8_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="section-8_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#new-package-for-today" id="toc-new-package-for-today" class="nav-link active" data-scroll-target="#new-package-for-today">New Package for Today</a></li>
  <li><a href="#introduction-to-linear-regression" id="toc-introduction-to-linear-regression" class="nav-link" data-scroll-target="#introduction-to-linear-regression">Introduction to Linear Regression</a>
  <ul class="collapse">
  <li><a href="#a-refresher-on-causality-and-experiments" id="toc-a-refresher-on-causality-and-experiments" class="nav-link" data-scroll-target="#a-refresher-on-causality-and-experiments">A Refresher on Causality and Experiments</a></li>
  <li><a href="#observational-data" id="toc-observational-data" class="nav-link" data-scroll-target="#observational-data">Observational Data</a>
  <ul class="collapse">
  <li><a href="#the-meaning-of-regression-estimates" id="toc-the-meaning-of-regression-estimates" class="nav-link" data-scroll-target="#the-meaning-of-regression-estimates">The Meaning of Regression Estimates</a></li>
  <li><a href="#interpreting-regression-estimates" id="toc-interpreting-regression-estimates" class="nav-link" data-scroll-target="#interpreting-regression-estimates">Interpreting Regression Estimates</a></li>
  <li><a href="#fitting-a-bivariate-regression-in-r" id="toc-fitting-a-bivariate-regression-in-r" class="nav-link" data-scroll-target="#fitting-a-bivariate-regression-in-r">Fitting a Bivariate Regression in R</a></li>
  <li><a href="#producing-a-nice-regression-table-stargazer" id="toc-producing-a-nice-regression-table-stargazer" class="nav-link" data-scroll-target="#producing-a-nice-regression-table-stargazer">Producing a Nice Regression Table: <code>stargazer()</code></a></li>
  <li><a href="#visualizing-a-bivariate-regression-in-ggplot2" id="toc-visualizing-a-bivariate-regression-in-ggplot2" class="nav-link" data-scroll-target="#visualizing-a-bivariate-regression-in-ggplot2">Visualizing a Bivariate Regression in <code>ggplot2</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression">Multiple Linear Regression</a></li>
  <li><a href="#example-with-house-data" id="toc-example-with-house-data" class="nav-link" data-scroll-target="#example-with-house-data">Example with House Data</a></li>
  <li><a href="#weighted-linear-regression" id="toc-weighted-linear-regression" class="nav-link" data-scroll-target="#weighted-linear-regression">Weighted Linear Regression</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Section 8. Regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sam Frederick </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="cell">

</div>
<section id="new-package-for-today" class="level1">
<h1>New Package for Today</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"stargazer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction-to-linear-regression" class="level1">
<h1>Introduction to Linear Regression</h1>
<section id="a-refresher-on-causality-and-experiments" class="level2">
<h2 class="anchored" data-anchor-id="a-refresher-on-causality-and-experiments">A Refresher on Causality and Experiments</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="section-8_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When we are in the world of experiments, the relationships in our data look like this. Because of random assignment, there are no differences between “treatment” and “control” groups on average. This means that any differences in the outcome variable should be attributable to the experimental treatment.</p>
</section>
<section id="observational-data" class="level2">
<h2 class="anchored" data-anchor-id="observational-data">Observational Data</h2>
<p>In the world of observational data (which all of us are for our final projects), we have to worry about the “treatment” and “control” groups being different. For example, if we want to study the effects of war on certain political outcomes, we have to worry about countries that go to war being systematically different from countries that do not go to war. In other words, in the real world, people or objects of study <strong><em>select into treatment</em></strong>. People choose to watch Fox News; they choose to get vaccinated; state lawmaking bodies choose to adopt policies.</p>
<p>The reasons that people or lawmaking bodies have for selecting some “treatment” we are interested in often have the potential to shape the outcomes we are interested in too. These causal relationships that lead to people taking a “treatment” and also people having certain outcomes mean we cannot identify the effect of our treatment on the outcome without accounting for the underlying variable that causes both “treatment” and outcome. This underlying variable causing both treatment and outcome is called a “confounder”. Thus, what we observe is:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="section-8_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Regression gives us a framework to account for these confounding variables and to better approximate the experimental ideal. It is important to note that we cannot ever be sure that we have accounted for all potential confounding variables, however. This is why experiments are the “gold standard” for identifying causal effects.</p>
<p>That said, sometimes it is impossible, infeasible, or unethical to conduct experiments, so observational data are the best available way to test our hypotheses. In these settings, it is crucial to think <strong><em>carefully</em></strong> about potential confounding variables which could cause “treated” units to systematically differ from “untreated” units. ## Bivariate Regression</p>
<p>Starting with a single variable, we have a formula of the form:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 * x_i + \varepsilon_i\]</span> We fit our Y or outcome variable to a line with slope <span class="math inline">\(\beta_1\)</span> and y-intercept <span class="math inline">\(\beta_0\)</span>. The <span class="math inline">\(\varepsilon\)</span> captures “error” which is not explained by our model. We estimate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> using Ordinary Least Squares (OLS) or Linear Regression.</p>
<p>Ordinary Least Squares finds the values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> which minimize the sum of squared residuals. Residuals are the difference between our actual, observed Y values and the predicted Y values using <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p>
<p>The sum of squared residuals (SSR) is calculated as:</p>
<p><span class="math display">\[SSR = \sum_{i =1}^n (y_i - \beta_0 - \beta_1 * x_i)^2\]</span></p>
<p>In the animation below, we can see how the OLS coefficient estimates (displayed on the last frame) minimize the Sum of Squared Residuals.</p>
<div class="cell" data-hash="section-8_cache/html/unnamed-chunk-7_0d23e9d3265c3aee9dc7b832d126f769">
<div class="cell-output-display">
<p><img src="section-8_files/figure-html/unnamed-chunk-7-1.gif" class="img-fluid"></p>
</div>
</div>
<section id="the-meaning-of-regression-estimates" class="level3">
<h3 class="anchored" data-anchor-id="the-meaning-of-regression-estimates">The Meaning of Regression Estimates</h3>
<p>After estimating the coefficients for the line that minimizes the sum of squared residuals, we want to interpret these coefficient estimates.</p>
<div class="cell-output-display">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 24%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Coefficient</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_0\)</span></td>
<td style="text-align: left;">Intercept</td>
<td style="text-align: left;">Predicted value of <span class="math inline">\(y_i\)</span> when <span class="math inline">\(x_i = 0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1\)</span></td>
<td style="text-align: left;">Coefficient Estimate/Slope</td>
<td style="text-align: left;">Predicted increase in <span class="math inline">\(y_i\)</span> corresponding to an increase of 1 in <span class="math inline">\(x_i\)</span></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="interpreting-regression-estimates" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-regression-estimates">Interpreting Regression Estimates</h3>
<p>Note: when we are working with observational data, we usually cannot definitively say that X <strong><em>causes</em></strong> Y because we cannot be sure that we have accurately and fully accounted for all confounding variables. As a result, we generally try not to say that <span class="math inline">\(\beta_1\)</span> is the estimate of the effect of X on Y, or that X leads to or causes Y.</p>
<p>Instead, we usually interpret our regression coefficients using some variation of the following:</p>
<ul>
<li><p>An increase of 1 in X is <strong>associated with</strong> an increase/decrease/change of <span class="math inline">\(\beta_1\)</span> in Y.</p></li>
<li><p>If X increases by 1, Y is <strong>expected</strong> to increase/decrease by <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>If X increases by 1, Y is <strong>predicted</strong> to increase/decrease by <span class="math inline">\(\beta_1\)</span>.</p></li>
</ul>
</section>
<section id="fitting-a-bivariate-regression-in-r" class="level3">
<h3 class="anchored" data-anchor-id="fitting-a-bivariate-regression-in-r">Fitting a Bivariate Regression in R</h3>
<p>To fit regressions in R, we usually use the <code>lm()</code> command. The main arguments we need to worry about are the formula and the data. The formula is of the form <code>DV~IV</code> where the DV is your dependent variable and the IV is your independent or predictor variables. The <code>lm()</code> command adds an intercept automatically, so you don’t have to worry about specifying this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>reg_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"section-8/regression_data.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>reg_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="section-8_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data =</span> reg_data)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = reg_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.3222  -2.4311  -0.1352   2.4702  10.1279 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.79069    0.68815   5.509  1.4e-06 ***
x            1.98246    0.07053  28.107  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.571 on 48 degrees of freedom
Multiple R-squared:  0.9427,    Adjusted R-squared:  0.9415 
F-statistic:   790 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The <code>lm()</code> function gives us a lot of useful information. It gives us summary statistics for Residuals at the top. It gives us estimates of our coefficients <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> as well as standard errors, t-values, and p-values. The p-values tell us the probability of observing a coefficient estimate at least as large as the one we actually observe if the null hypothesis that the coefficient estimate is 0 is true. Finally, we get a variety of measures of model fit and statistics for the model.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>1. How would we interpret the intercept estimate of our model?</strong></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><strong>1. How would we interpret the intercept estimate of our model?</strong></p>
<p>When x is 0, the expected value of y is about 3.8.</p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><strong>2. How would we interpret the coefficient estimate for x in our model?</strong></p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p><strong>2. How would we interpret the coefficient estimate for x in our model?</strong></p>
<p>As x increases by 1, we would expect y to increase by about 2.</p>
</div>
</div>
</div>
</section>
<section id="producing-a-nice-regression-table-stargazer" class="level3">
<h3 class="anchored" data-anchor-id="producing-a-nice-regression-table-stargazer">Producing a Nice Regression Table: <code>stargazer()</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod, <span class="at">type =</span> <span class="st">'text'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===============================================
                        Dependent variable:    
                    ---------------------------
                                 y             
-----------------------------------------------
x                            1.982***          
                              (0.071)          
                                               
Constant                     3.791***          
                              (0.688)          
                                               
-----------------------------------------------
Observations                    50             
R2                             0.943           
Adjusted R2                    0.942           
Residual Std. Error       4.571 (df = 48)      
F Statistic           790.029*** (df = 1; 48)  
===============================================
Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'text'</span>, <span class="co"># specifying type = "text" can help when trying to format the table, but generally we want to use type = "html"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Title"</span>, <span class="co"># this sets the title of the table</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>( <span class="st">"f"</span>, <span class="st">"ser"</span>),<span class="co"># this helps omit unnecessary statistics, including the F-Statistic and the Standard Error of the Regression </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(<span class="st">"Covariate 1"</span>, <span class="st">"Intercept"</span>), <span class="co">#sets the labels of the coefficient estimates (x, intercept)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">"Dependent Variable 1"</span>), <span class="co">#this sets the labels of the columns</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.caption =</span> <span class="st">"Dependent Var"</span>, <span class="co">#this sets a caption for the dependent variable</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.labels =</span> <span class="fu">c</span>(<span class="st">"Y"</span>)) <span class="co">#this is useful if you are using multiple different dependent variables across multiple models</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Title
========================================
                    Dependent Var       
             ---------------------------
                          Y             
                Dependent Variable 1    
----------------------------------------
Covariate 1           1.982***          
                       (0.071)          
                                        
Intercept             3.791***          
                       (0.688)          
                                        
----------------------------------------
Observations             50             
R2                      0.943           
Adjusted R2             0.942           
========================================
Note:        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
</section>
<section id="visualizing-a-bivariate-regression-in-ggplot2" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-a-bivariate-regression-in-ggplot2">Visualizing a Bivariate Regression in <code>ggplot2</code></h3>
<p><code>ggplot2</code> gives us a nice function for drawing a regression line for our data. The function is <code>geom_smooth()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>reg_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="section-8_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>With the <code>method</code> argument, we are telling <code>ggplot</code> to add a line from a linear model to our plot. The <code>se = F</code> argument tells <code>ggplot</code> not to plot the standard error of the regression line.</p>
</section>
</section>
</section>
<section id="multiple-linear-regression" class="level1">
<h1>Multiple Linear Regression</h1>
<p>As noted above, when we are working with observational data, we want to account for potential confounding variables that affect both one’s probability of getting a treatment and one’s outcome variable. We can do this by simply adding potential confounding variables to the formula.</p>
<p>Instead of estimating the bivariate regression (<span class="math inline">\(y_i = \beta_0 + \beta_1*x_i + \varepsilon_i\)</span>), we estimate:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1*x_1i + \beta_2*x_2i + ... + \beta_k*x_ki + \varepsilon_i\]</span></p>
<p>Without adding the confounding variables to our regression equation, our estimates of the coefficients will be <strong>biased</strong>. This is known as Omitted Variables Bias.</p>
<p>Let’s take a look at an example of confounding and how that affects our regression results.</p>
<p>These are fake data that come from a true model of <span class="math inline">\(y_i = 4+2*x_i+5*confound_i + var1_i + \varepsilon_i\)</span> and <span class="math inline">\(x_i = 2 + 2*confound_i + \gamma_i\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>confound <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"section-8/confound.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data =</span> confound)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = confound)

Residuals:
    Min      1Q  Median      3Q     Max 
-57.504 -10.331  -0.022  10.279  59.043 

Coefficients:
            Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) 0.096617   0.319234    0.303    0.762    
x           4.486664   0.002678 1675.107   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.38 on 9998 degrees of freedom
Multiple R-squared:  0.9964,    Adjusted R-squared:  0.9964 
F-statistic: 2.806e+06 on 1 and 9998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Without accounting for the confounding variable, we get a coefficient estimate for <span class="math inline">\(\beta_1\)</span> of about 4.5 (remember the true coefficient for x is 2). What happens if we include the confounding variable in our regression model?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x<span class="sc">+</span>confound, <span class="at">data =</span> confound)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + confound, data = confound)

Residuals:
    Min      1Q  Median      3Q     Max 
-42.504  -7.997  -0.068   7.745  44.821 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 11.29233    0.27590   40.93   &lt;2e-16 ***
x            2.00932    0.02908   69.09   &lt;2e-16 ***
confound     4.97505    0.05826   85.39   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.7 on 9997 degrees of freedom
Multiple R-squared:  0.9979,    Adjusted R-squared:  0.9979 
F-statistic: 2.43e+06 on 2 and 9997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>If we include the confounding variable in our model as a “control” variable, our estimate of the coefficient estimate for x decreases to about 2–an unbiased estimate of the true value (2).</p>
<p>Finally, because <span class="math inline">\(var1\)</span> does not affect <strong>both</strong> x and y, its exclusion from our regression model does not bias our results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x<span class="sc">+</span>confound<span class="sc">+</span>var1, <span class="at">data =</span> confound)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod1, mod2, mod3, <span class="at">type =</span> <span class="st">"html"</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">"ser"</span>,  <span class="st">"f"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<table style="text-align:center">
<tbody><tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
y
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
x
</td>
<td>
4.487<sup>***</sup>
</td>
<td>
2.009<sup>***</sup>
</td>
<td>
1.981<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.003)
</td>
<td>
(0.029)
</td>
<td>
(0.015)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
confound
</td>
<td>
</td>
<td>
4.975<sup>***</sup>
</td>
<td>
5.036<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.058)
</td>
<td>
(0.030)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
var1
</td>
<td>
</td>
<td>
</td>
<td>
1.004<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.097
</td>
<td>
11.292<sup>***</sup>
</td>
<td>
4.181<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.319)
</td>
<td>
(0.276)
</td>
<td>
(0.147)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
10,000
</td>
<td>
10,000
</td>
<td>
10,000
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.996
</td>
<td>
0.998
</td>
<td>
0.999
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.996
</td>
<td>
0.998
</td>
<td>
0.999
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="3" style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
</section>
<section id="example-with-house-data" class="level1">
<h1>Example with House Data</h1>
<p>Let’s do a full analysis with our House data. Let’s say we want to test the hypothesis that campaign spending leads to a better electoral performance. We can fit a simple regression of voteshare on logged campaign spending.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>house <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"house2020_elections.csv"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mod1_house <span class="ot">&lt;-</span> <span class="fu">lm</span>(voteshare<span class="sc">~</span><span class="fu">log</span>(disbursements), <span class="at">data =</span> house)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1_house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voteshare ~ log(disbursements), data = house)

Residuals:
   Min     1Q Median     3Q    Max 
-41.22 -10.82  -2.74  10.53  50.93 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        -17.1821     4.6197  -3.719 0.000215 ***
log(disbursements)   5.0385     0.3381  14.902  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.03 on 724 degrees of freedom
Multiple R-squared:  0.2347,    Adjusted R-squared:  0.2337 
F-statistic: 222.1 on 1 and 724 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This is interesting by itself; however, there is good reason to believe there are some omitted variables here. Specifically, we might think that certain types of candidates are likely to both raise a lot of money and perform well electorally. This would make it appear that the spending is leading to the voteshare, when really it is the confounding variable that is generating this relationship. One such confounding variable is incumbency.</p>
<p>We can account for incumbency status by adding it into our regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mod2_house <span class="ot">&lt;-</span> <span class="fu">lm</span>(voteshare<span class="sc">~</span><span class="fu">log</span>(disbursements)<span class="sc">+</span>incumbent_challenge_full, <span class="at">data =</span> house)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2_house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voteshare ~ log(disbursements) + incumbent_challenge_full, 
    data = house)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.400  -6.307   0.487   5.538  47.319 

Coefficients:
                                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                        13.2845     3.7549   3.538 0.000429 ***
log(disbursements)                  1.9156     0.2915   6.572 9.51e-11 ***
incumbent_challenge_fullIncumbent  23.0113     1.0141  22.691  &lt; 2e-16 ***
incumbent_challenge_fullOpen seat   6.7225     1.5444   4.353 1.54e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.43 on 722 degrees of freedom
Multiple R-squared:  0.5586,    Adjusted R-squared:  0.5568 
F-statistic: 304.6 on 3 and 722 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Indeed, we can see that our intuitions about incumbency status were likely pretty good: the coefficient estimate for campaign spending decreased by a lot once we include incumbency status.</p>
<p>The election in 2020 was a fairly good one for Republican House candidates, so we might think that party is also an important potential confounder: Republicans might have been both able to raise more money and performed better in the election.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mod3_house <span class="ot">&lt;-</span> <span class="fu">lm</span>(voteshare<span class="sc">~</span><span class="fu">log</span>(disbursements)<span class="sc">+</span>incumbent_challenge_full <span class="sc">+</span> party, <span class="at">data =</span> house)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3_house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voteshare ~ log(disbursements) + incumbent_challenge_full + 
    party, data = house)

Residuals:
    Min      1Q  Median      3Q     Max 
-42.740  -6.081   0.432   5.247  48.549 

Coefficients:
                                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                        11.7844     3.7772   3.120  0.00188 ** 
log(disbursements)                  1.9367     0.2903   6.672 5.02e-11 ***
incumbent_challenge_fullIncumbent  23.1739     1.0112  22.917  &lt; 2e-16 ***
incumbent_challenge_fullOpen seat   6.8515     1.5381   4.455 9.74e-06 ***
partyREP                            2.3409     0.8482   2.760  0.00593 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.38 on 721 degrees of freedom
Multiple R-squared:  0.5632,    Adjusted R-squared:  0.5608 
F-statistic: 232.4 on 4 and 721 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>It does not appear that party was a big confounding variable (the coefficient estimate for spending didn’t change much after we included party). That said, we do see that Republican candidates did perform better electorally than Democratic candidates in 2020.</p>
<p>Finally, let’s put all of these regression models together:</p>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod1_house, mod2_house, mod3_house, <span class="at">type =</span> <span class="st">"html"</span>, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">"ser"</span>, <span class="st">"f"</span>), </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels =</span> <span class="fu">c</span>(<span class="st">"log(Spending)"</span>, <span class="st">"Incumbent"</span>, <span class="st">"Open-Seat"</span>, <span class="st">"Republican"</span>, <span class="st">"Intercept"</span>), </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.labels =</span> <span class="fu">c</span>(<span class="st">"Vote Share"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<table style="text-align:center">
<tbody><tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
Vote Share
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
log(Spending)
</td>
<td>
5.038<sup>***</sup>
</td>
<td>
1.916<sup>***</sup>
</td>
<td>
1.937<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.338)
</td>
<td>
(0.291)
</td>
<td>
(0.290)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Incumbent
</td>
<td>
</td>
<td>
23.011<sup>***</sup>
</td>
<td>
23.174<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(1.014)
</td>
<td>
(1.011)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Open-Seat
</td>
<td>
</td>
<td>
6.722<sup>***</sup>
</td>
<td>
6.852<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(1.544)
</td>
<td>
(1.538)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Republican
</td>
<td>
</td>
<td>
</td>
<td>
2.341<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
(0.848)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Intercept
</td>
<td>
-17.182<sup>***</sup>
</td>
<td>
13.284<sup>***</sup>
</td>
<td>
11.784<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(4.620)
</td>
<td>
(3.755)
</td>
<td>
(3.777)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
726
</td>
<td>
726
</td>
<td>
726
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.235
</td>
<td>
0.559
</td>
<td>
0.563
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.234
</td>
<td>
0.557
</td>
<td>
0.561
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="3" style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
</section>
<section id="weighted-linear-regression" class="level1">
<h1>Weighted Linear Regression</h1>
<p>The last thing to note is that when we are using data with weights, we want to conduct weighted regressions. We can do this using the <code>weights</code> argument in the <code>lm()</code> function.</p>
<p>For example, if we go back to the CES dataset we worked with last section:</p>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ces <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"ces2020_example.csv"</span>)<span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ideo5<span class="sc">%in%</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span><span class="sc">&amp;</span>pid3<span class="sc">%in%</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>mod1_ces <span class="ot">&lt;-</span> <span class="fu">lm</span>(ideo5<span class="sc">~</span><span class="fu">factor</span>(pid3), <span class="at">data =</span> ces)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>mod2_ces <span class="ot">&lt;-</span> <span class="fu">lm</span>(ideo5<span class="sc">~</span><span class="fu">factor</span>(pid3), <span class="at">data =</span> ces, <span class="at">weights =</span> commonweight)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(mod1_ces, mod2_ces, <span class="at">type =</span> <span class="st">"html"</span>, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"ser"</span>), </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">"Unweighted"</span>, <span class="st">"Weighted"</span>), </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">dep.var.labels =</span> <span class="fu">c</span>(<span class="st">"Vote Share"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<table style="text-align:center">
<tbody><tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
Vote Share
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Unweighted
</td>
<td>
Weighted
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
factor(pid3)2
</td>
<td>
2.005<sup>***</sup>
</td>
<td>
2.098<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.074)
</td>
<td>
(0.073)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
factor(pid3)3
</td>
<td>
0.935<sup>***</sup>
</td>
<td>
1.114<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.073)
</td>
<td>
(0.078)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
2.146<sup>***</sup>
</td>
<td>
2.149<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.047)
</td>
<td>
(0.051)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
874
</td>
<td>
874
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.457
</td>
<td>
0.490
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.456
</td>
<td>
0.489
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>